{"version":3,"file":"cli.mjs","sources":["../src/cli.ts"],"sourcesContent":["import type { ParsedArgs } from 'minimist';\nimport type { Options } from '#main';\n\nimport { createRequire } from 'module';\nimport { resolve } from 'path';\nimport chalk from 'chalk';\nimport minimist from 'minimist';\nimport { isSymlinkAvailable, mklnks } from '#main';\n\nconst { gray, red } = chalk;\nconst require = createRequire(import.meta.url);\nconst { name, version } = require('#@') as typeof import('#@');\n\nconst helpText = `\n${name} v${version}\nCreate links as configured.\n\nUSAGE:\n    $ ${name} [FLAGS]\n\nFLAGS:\n    -a, --available         Check if symlinks are available (for Windows).\n\n    -c, --config <FILE>     Run with isolated config file (*.{json|js|cjs|mjs}).\n\n    -d, --dry-run           Run trial execution without actual link creation.\n                            (Override \\`Options.dryRun\\` to \\`true\\`.)\n\n    -f, --force             Force to remove existing files/directories in the link path.\n                            (Override \\`Options.force\\` to \\`true\\`.)\n\n    -h, --help              Display this message.\n\n    -q, --quiet             NOT to display logs.\n                            (Override \\`Options.quiet\\` to \\`true\\`.)\n\n    -s, --silent            NOT to display logs & warnings.\n                            (Override \\`Options.silent\\` to \\`true\\`.)\n\n    -v, --version           Display version number.\n\nBy default, load \"${name}\" field in \\`package.json\\` as configurations.\n`.trim();\n\nconst alias = Object.freeze({\n    a: 'available',\n    c: 'config',\n    d: 'dry-run',\n    f: 'force',\n    h: 'help',\n    q: 'quiet',\n    s: 'silent',\n    v: 'version',\n});\n\ntype Args = {\n    [P in keyof typeof alias]?: P extends 'c' ? string : true;\n} & Readonly<ParsedArgs>;\n\nconst args = minimist(process.argv.slice(2), {\n    alias,\n    boolean: Object.keys(alias).filter(k => k !== 'c'),\n    string: ['c']\n}) as Args;\n\nconst knownFlags = new Set(Object.entries(alias).flat()).add('_').add('--');\nconst unknownFlags = Object.keys(args).filter(key => !knownFlags.has(key));\n\nawait (async () => {\n    const options = {} as Options;\n    if (0 < unknownFlags.length) {\n        console.error(red('Unknown flags:', unknownFlags.join()));\n        console.error(gray(`Enter \\`${name} --help\\``));\n        return process.exit(1);\n    } else if (args.h) {\n        return console.log(helpText);\n    } else if (args.v) {\n        return console.log(version);\n    } else if (args.a) {\n        return console.log('Symlink available:', await isSymlinkAvailable());\n    } else if ('c' in args) {\n        const cfg = args.c;\n        if (!cfg) {\n            console.error(red('No config file specified.'));\n            console.error(gray(`Enter \\`${name} --help\\``));\n            return process.exit(1);\n        }\n        try {\n            Object.assign(options, await loadConfig(cfg));\n        } catch (e) {\n            console.error(red('Failed to load config:', cfg));\n            return process.exit(1);\n        }\n    } else {\n        try {\n            const pkg = require(resolve('package.json'));   // eslint-disable-line @typescript-eslint/no-unsafe-assignment\n            Object.assign(options, pkg[name]);              // eslint-disable-line @typescript-eslint/no-unsafe-member-access\n        } catch (e) {\n            console.error(red('Failed to load config:', './package.json'));\n            return process.exit(1);\n        }\n    }\n    args.d && (options.dryRun = true);\n    args.f && (options.force = true);\n    args.q && (options.quiet = true);\n    args.s && (options.silent = true);\n    try {\n        await mklnks(options);\n    } catch (e) {\n        console.error(red(e));\n        process.exit(1);\n    }\n})();\n\nasync function loadConfig(path: string) {\n    path = resolve(path);\n    if (path.endsWith('js')) {\n        const module = await import(path) as { default: Options };\n        return module.default;\n    } else {\n        return require(path) as Options;\n    }\n}\n"],"names":["gray","red","chalk","require","createRequire","import","meta","url","name","version","helpText","trim","alias","Object","freeze","a","c","d","f","h","q","s","v","args","minimist","process","argv","slice","boolean","keys","filter","k","string","knownFlags","Set","entries","flat","add","unknownFlags","key","has","options","length","console","error","join","exit","log","isSymlinkAvailable","cfg","assign","loadConfig","e","pkg","resolve","dryRun","force","quiet","silent","mklnks","async","path","endsWith","module","default"],"mappings":";0KASA,MAAMA,KAAEA,EAAIC,IAAEA,GAAQC,EACtB,MAAMC,EAAUC,EAAcC,OAAOC,KAAKC,KAC1C,MAAMC,KAAEA,EAAIC,QAAEA,GAAYN,EAAQ,MAElC,MAAMO,EAAW,KACfF,MAASC,mDAIHD,s3BAuBYA,oDAClBG,OAEF,MAAMC,EAAQC,OAAOC,OAAO,CACxBC,EAAG,YACHC,EAAG,SACHC,EAAG,UACHC,EAAG,QACHC,EAAG,OACHC,EAAG,QACHC,EAAG,SACHC,EAAG,YAOP,MAAMC,EAAOC,EAASC,QAAQC,KAAKC,MAAM,GAAI,CACzCf,MAAAA,EACAgB,QAASf,OAAOgB,KAAKjB,GAAOkB,QAAOC,GAAKA,IAAM,MAC9CC,OAAQ,CAAC,OAGb,MAAMC,EAAa,IAAIC,IAAIrB,OAAOsB,QAAQvB,GAAOwB,QAAQC,IAAI,KAAKA,IAAI,MACtE,MAAMC,EAAezB,OAAOgB,KAAKN,GAAMO,QAAOS,IAAQN,EAAWO,IAAID,UAE/D,WACF,MAAME,EAAU,GAChB,GAAI,EAAIH,EAAaI,OAAQ,CACzBC,QAAQC,MAAM3C,EAAI,iBAAkBqC,EAAaO,SACjDF,QAAQC,MAAM5C,EAAK,WAAWQ,eAC9B,OAAOiB,QAAQqB,KAAK,QACjB,GAAIvB,EAAKJ,EAAG,CACf,OAAOwB,QAAQI,IAAIrC,QAChB,GAAIa,EAAKD,EAAG,CACf,OAAOqB,QAAQI,IAAItC,QAChB,GAAIc,EAAKR,EAAG,CACf,OAAO4B,QAAQI,IAAI,2BAA4BC,UAC5C,GAAI,MAAOzB,EAAM,CACpB,MAAM0B,EAAM1B,EAAKP,EACjB,IAAKiC,EAAK,CACNN,QAAQC,MAAM3C,EAAI,8BAClB0C,QAAQC,MAAM5C,EAAK,WAAWQ,eAC9B,OAAOiB,QAAQqB,KAAK,GAExB,IACIjC,OAAOqC,OAAOT,QAAeU,EAAWF,IAC1C,MAAOG,GACLT,QAAQC,MAAM3C,EAAI,yBAA0BgD,IAC5C,OAAOxB,QAAQqB,KAAK,QAErB,CACH,IACI,MAAMO,EAAMlD,EAAQmD,EAAQ,iBAC5BzC,OAAOqC,OAAOT,EAASY,EAAI7C,IAC7B,MAAO4C,GACLT,QAAQC,MAAM3C,EAAI,yBAA0B,mBAC5C,OAAOwB,QAAQqB,KAAK,IAG5BvB,EAAKN,IAAMwB,EAAQc,OAAS,MAC5BhC,EAAKL,IAAMuB,EAAQe,MAAQ,MAC3BjC,EAAKH,IAAMqB,EAAQgB,MAAQ,MAC3BlC,EAAKF,IAAMoB,EAAQiB,OAAS,MAC5B,UACUC,EAAOlB,GACf,MAAOW,GACLT,QAAQC,MAAM3C,EAAImD,IAClB3B,QAAQqB,KAAK,KA1Cf,GA8CNc,eAAeT,EAAWU,GACtBA,EAAOP,EAAQO,GACf,GAAIA,EAAKC,SAAS,MAAO,CACrB,MAAMC,QAAe1D,OAAOwD,GAC5B,OAAOE,EAAOC,YACX,CACH,OAAO7D,EAAQ0D"}