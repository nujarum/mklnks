{"version":3,"file":"cli.mjs","sources":["../src/cli.ts"],"sourcesContent":["/* eslint-disable\n    @typescript-eslint/no-confusing-void-expression,\n */\nimport type { ParsedArgs } from 'minimist';\nimport type { Options } from '#main';\n\nimport { createRequire } from 'node:module';\nimport { resolve } from 'node:path';\nimport chalk from 'chalk';\nimport minimist from 'minimist';\nimport { isSymlinkAvailable, mklnks } from '#main';\n\nconst { gray, red } = chalk;\nconst require = createRequire(import.meta.url);\nconst { bin, version } = require('#@') as typeof import('#@');\nconst [name] = Object.keys(bin) as ['mklnks'];\n\nconst helpText = `\n${name} v${version}\nCreate links as configured.\n\nUSAGE:\n    $ ${name} [FLAGS]\n\nFLAGS:\n    -a, --available         Check if symlinks are available (for Windows).\n\n    -c, --config <FILE>     Run with isolated config file (*.{json|js|cjs|mjs}).\n\n    -d, --dry-run           Run trial execution without actual link creation.\n                            (Override \\`Options.dryRun\\` to \\`true\\`.)\n\n    -f, --force             Force to remove existing files/directories in the link path.\n                            (Override \\`Options.force\\` to \\`true\\`.)\n\n    -h, --help              Display this message.\n\n    -q, --quiet             NOT to display logs.\n                            (Override \\`Options.quiet\\` to \\`true\\`.)\n\n    -s, --silent            NOT to display logs & warnings.\n                            (Override \\`Options.silent\\` to \\`true\\`.)\n\n    -v, --version           Display version number.\n\nBy default, load \"${name}\" field in \\`package.json\\` as configurations.\n`.trim();\n\nconst alias = Object.freeze({\n    a: 'available',\n    c: 'config',\n    d: 'dry-run',\n    f: 'force',\n    h: 'help',\n    q: 'quiet',\n    s: 'silent',\n    v: 'version',\n});\n\ntype Args = {\n    [P in keyof typeof alias]?: P extends 'c' ? string : true;\n} & Readonly<ParsedArgs>;\n\nconst args = minimist(process.argv.slice(2), {\n    alias,\n    boolean: Object.keys(alias).filter(k => k !== 'c'),\n    string: ['c']\n}) as Args;\n\nconst knownFlags = new Set(Object.entries(alias).flat()).add('_').add('--');\nconst unknownFlags = Object.keys(args).filter(key => !knownFlags.has(key));\n\nawait (async () => {\n    const options = {} as Options;\n    if (0 < unknownFlags.length) {\n        console.error(red('Unknown flags:', unknownFlags.join()));\n        console.error(gray(`Enter \\`${name} --help\\``));\n        return process.exit(1);\n    } else if (args.h) {\n        return console.log(helpText);\n    } else if (args.v) {\n        return console.log(version);\n    } else if (args.a) {\n        return console.log('Symlink available:', await isSymlinkAvailable());\n    } else if ('c' in args) {\n        const cfg = args.c;\n        if (!cfg) {\n            console.error(red('No config file specified.'));\n            console.error(gray(`Enter \\`${name} --help\\``));\n            return process.exit(1);\n        }\n        try {\n            Object.assign(options, await loadConfig(cfg));\n        } catch (e) {\n            console.error(red('Failed to load config:', cfg));\n            return process.exit(1);\n        }\n    } else {\n        try {\n            const pkg = require(resolve('package.json'));   // eslint-disable-line @typescript-eslint/no-unsafe-assignment\n            Object.assign(options, pkg[name]);              // eslint-disable-line @typescript-eslint/no-unsafe-member-access\n        } catch (e) {\n            console.error(red('Failed to load config:', './package.json'));\n            return process.exit(1);\n        }\n    }\n    args.d && (options.dryRun = true);\n    args.f && (options.force = true);\n    args.q && (options.quiet = true);\n    args.s && (options.silent = true);\n    try {\n        await mklnks(options);\n    } catch (e) {\n        console.error(red(e));\n        process.exit(1);\n    }\n})();\n\nasync function loadConfig(path: string) {\n    path = resolve(path);\n    if (path.endsWith('js')) {\n        const module = await import(path) as { default: Options };\n        return module.default;\n    } else {\n        return require(path) as Options;\n    }\n}\n"],"names":["gray","red","chalk","require","createRequire","url","bin","version","name","Object","keys","helpText","trim","alias","freeze","a","c","d","f","h","q","s","v","args","minimist","process","argv","slice","boolean","filter","k","string","knownFlags","Set","entries","flat","add","unknownFlags","key","has","options","length","console","error","join","exit","log","isSymlinkAvailable","cfg","assign","loadConfig","e","pkg","resolve","dryRun","force","quiet","silent","mklnks","async","path","endsWith","module","import","default"],"mappings":";oLAYA,MAAMA,KAAEA,EAAIC,IAAEA,GAAQC,EACtB,MAAMC,EAAUC,cAA0BC,KAC1C,MAAMC,IAAEA,EAAGC,QAAEA,GAAYJ,EAAQ,MACjC,MAAOK,GAAQC,OAAOC,KAAKJ,GAE3B,MAAMK,EAAW,KACfH,MAASD,mDAIHC,s3BAuBYA,oDAClBI,OAEF,MAAMC,EAAQJ,OAAOK,OAAO,CACxBC,EAAG,YACHC,EAAG,SACHC,EAAG,UACHC,EAAG,QACHC,EAAG,OACHC,EAAG,QACHC,EAAG,SACHC,EAAG,YAOP,MAAMC,EAAOC,EAASC,QAAQC,KAAKC,MAAM,GAAI,CACzCd,QACAe,QAASnB,OAAOC,KAAKG,GAAOgB,QAAOC,GAAKA,IAAM,MAC9CC,OAAQ,CAAC,OAGb,MAAMC,EAAa,IAAIC,IAAIxB,OAAOyB,QAAQrB,GAAOsB,QAAQC,IAAI,KAAKA,IAAI,MACtE,MAAMC,EAAe5B,OAAOC,KAAKa,GAAMM,QAAOS,IAAQN,EAAWO,IAAID,UAE/D,WACF,MAAME,EAAU,CAAA,EAChB,GAAI,EAAIH,EAAaI,OAAQ,CACzBC,QAAQC,MAAM1C,EAAI,iBAAkBoC,EAAaO,SACjDF,QAAQC,MAAM3C,EAAK,WAAWQ,eAC9B,OAAOiB,QAAQoB,KAAK,EACvB,MAAM,GAAItB,EAAKJ,EAAG,CACf,OAAOuB,QAAQI,IAAInC,EACtB,MAAM,GAAIY,EAAKD,EAAG,CACf,OAAOoB,QAAQI,IAAIvC,EACtB,MAAM,GAAIgB,EAAKR,EAAG,CACf,OAAO2B,QAAQI,IAAI,2BAA4BC,IAClD,MAAM,GAAI,MAAOxB,EAAM,CACpB,MAAMyB,EAAMzB,EAAKP,EACjB,IAAKgC,EAAK,CACNN,QAAQC,MAAM1C,EAAI,8BAClByC,QAAQC,MAAM3C,EAAK,WAAWQ,eAC9B,OAAOiB,QAAQoB,KAAK,EACvB,CACD,IACIpC,OAAOwC,OAAOT,QAAeU,EAAWF,GAC3C,CAAC,MAAOG,GACLT,QAAQC,MAAM1C,EAAI,yBAA0B+C,IAC5C,OAAOvB,QAAQoB,KAAK,EACvB,CACJ,KAAM,CACH,IACI,MAAMO,EAAMjD,EAAQkD,EAAQ,iBAC5B5C,OAAOwC,OAAOT,EAASY,EAAI5C,GAC9B,CAAC,MAAO2C,GACLT,QAAQC,MAAM1C,EAAI,yBAA0B,mBAC5C,OAAOwB,QAAQoB,KAAK,EACvB,CACJ,CACDtB,EAAKN,IAAMuB,EAAQc,OAAS,MAC5B/B,EAAKL,IAAMsB,EAAQe,MAAQ,MAC3BhC,EAAKH,IAAMoB,EAAQgB,MAAQ,MAC3BjC,EAAKF,IAAMmB,EAAQiB,OAAS,MAC5B,UACUC,EAAOlB,EAChB,CAAC,MAAOW,GACLT,QAAQC,MAAM1C,EAAIkD,IAClB1B,QAAQoB,KAAK,EAChB,CACJ,EA5CK,GA8CNc,eAAeT,EAAWU,GACtBA,EAAOP,EAAQO,GACf,GAAIA,EAAKC,SAAS,MAAO,CACrB,MAAMC,QAAeC,OAAOH,GAC5B,OAAOE,EAAOE,OACjB,KAAM,CACH,OAAO7D,EAAQyD,EAClB,CACL"}